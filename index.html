<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rechnung – Kleinunternehmer (§19 UStG)</title>
  <style>
    :root{
      --bg:#0b1220; --panel:#101a2f; --card:#0f1a33; --line:rgba(255,255,255,.10);
      --text:#e9f0ff; --muted:rgba(233,240,255,.70);
      --accent:#4cc9f0; --btn:#1a2b55;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#071025,#0b1220);color:var(--text)}
    .wrap{max-width:980px;margin:24px auto;padding:0 16px}
    .top{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:14px}
    .brand{display:flex;gap:10px;align-items:center}
    .logo{width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#7b2cff);display:grid;place-items:center;font-weight:800}
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    button{border:1px solid var(--line);background:var(--btn);color:var(--text);padding:10px 12px;border-radius:12px;cursor:pointer}
    button:hover{border-color:rgba(255,255,255,.22)}
    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:14px}
    .card{background:rgba(16,26,47,.75);border:1px solid var(--line);border-radius:16px;padding:14px}
    .card h2{margin:0 0 10px 0;font-size:18px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    label{font-size:12px;color:var(--muted);display:block;margin:8px 0 6px}
    input,select,textarea{
      width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--line);
      background:rgba(0,0,0,.18);color:var(--text);outline:none
    }
    textarea{min-height:74px;resize:vertical}
    .hint{font-size:12px;color:var(--muted);margin-top:10px}
    .totals{display:grid;gap:8px;margin-top:8px}
    .totals .line{display:flex;justify-content:space-between;gap:12px;padding:10px 12px;border-radius:12px;background:rgba(0,0,0,.12);border:1px solid var(--line)}
    .totals .grand{border-color:rgba(76,201,240,.35)}
    .ustg-note{margin-top:10px;padding:10px 12px;border-radius:12px;border:1px dashed rgba(76,201,240,.35);color:var(--text);background:rgba(76,201,240,.08)}
    .muted{color:var(--muted)}
    .right{display:grid;gap:12px}
    .preview{border:1px solid var(--line);border-radius:16px;background:rgba(0,0,0,.12);padding:0;overflow:hidden}
    .previewHeader{padding:12px 14px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;gap:10px}
    .previewBody{padding:14px}
    .pill{font-size:12px;color:var(--muted)}
    .small{font-size:12px;color:var(--muted)}
    .table{width:100%;border-collapse:collapse;margin-top:10px}
    .table th,.table td{border-bottom:1px solid rgba(255,255,255,.08);padding:8px 6px;text-align:left;font-size:13px}
    .table th{color:var(--muted);font-weight:600}
    .table td:last-child,.table th:last-child{text-align:right}
    .table td:nth-child(2){color:var(--muted)}
    @media (max-width:880px){.grid{grid-template-columns:1fr}}
    /* PRINT (PDF) */
    @media print{
      body{background:#fff;color:#000}
      .wrap{max-width:100%;margin:0;padding:0}
      .no-print{display:none !important}
      .print-card{border:0;background:#fff}
      .preview{border:0}
      .previewHeader{border:0}
      .previewBody{padding:0}
      .ustg-note{border:1px solid #ccc;background:#fff;color:#000}
      input,select,textarea{border:0}
      .card{border:0;background:#fff}
      .logo{background:#000;color:#fff}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top no-print">
      <div class="brand">
        <div class="logo">MS</div>
        <div>
          <div style="font-weight:700">Masculine Security</div>
          <div class="small">Rechnung (Kleinunternehmer möglich)</div>
        </div>
      </div>
      <div class="actions">
        <button id="btnSave">Speichern</button>
        <button id="btnPrint">PDF öffnen</button>
        <button id="btnReset">Reset</button>
      </div>
    </div>

    <div class="grid">
      <!-- FORM -->
      <div class="card no-print">
        <h2>Rechnung erstellen</h2>

        <div class="row">
          <div>
            <label>Rechnungs-Nr.</label>
            <input id="invNo" value="RE-2026-0001" />
          </div>
          <div>
            <label>Datum</label>
            <input id="invDate" type="date" />
          </div>
        </div>

        <label>Kunde (Name)</label>
        <input id="custName" placeholder="z.B. Beispiel Kunde GmbH" />

        <div class="row">
          <div>
            <label>Leistung / Beschreibung</label>
            <input id="desc" placeholder="z.B. Objektschutz 12h" />
          </div>
          <div>
            <label>Betrag (EUR)</label>
            <input id="amount" type="number" step="0.01" value="0.00" />
          </div>
        </div>

        <div class="row">
          <div>
            <label>USt % (0 für Kleinunternehmer)</label>
            <input id="vatRate" type="number" step="0.01" value="0" />
          </div>
          <div>
            <label>Status</label>
            <select id="status">
              <option value="Entwurf">Entwurf</option>
              <option value="Gesendet">Gesendet</option>
              <option value="Bezahlt">Bezahlt</option>
            </select>
          </div>
        </div>

        <label>Notiz (optional)</label>
        <textarea id="note" placeholder="z.B. Zahlungsziel 7 Tage, IBAN ..."></textarea>

        <div class="hint">
          ✅ Haddii USt = 0 → wuxuu si otomaatig ah u muujinayaa: <b>“Gemäß §19 UStG …”</b><br/>
          ✅ Haddii USt > 0 → wuxuu xisaabinayaa VAT oo hint-ka wuu qarsoomayaa.
        </div>
      </div>

      <!-- PREVIEW / PRINT AREA -->
      <div class="right">
        <div class="preview print-card" id="printArea">
          <div class="previewHeader">
            <div>
              <div style="font-weight:800">Rechnung</div>
              <div class="pill" id="pMeta">—</div>
            </div>
            <div class="pill" id="pStatus">Entwurf</div>
          </div>

          <div class="previewBody">
            <div style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap">
              <div>
                <div style="font-weight:700">Masculine Security</div>
                <div class="muted" style="font-size:12px">Bremen · Deutschland</div>
              </div>
              <div style="text-align:right">
                <div class="muted" style="font-size:12px">Kunde</div>
                <div style="font-weight:700" id="pCustomer">—</div>
              </div>
            </div>

            <table class="table" style="margin-top:12px">
              <thead>
                <tr>
                  <th>Leistung</th>
                  <th>Beschreibung</th>
                  <th>Betrag</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Service</td>
                  <td id="pDesc" class="muted">—</td>
                  <td id="pAmount">0,00 €</td>
                </tr>
              </tbody>
            </table>

            <div class="totals">
              <div class="line">
                <span class="muted">Zwischensumme</span>
                <span id="pNet">0,00 €</span>
              </div>

              <!-- ✅ HALKAN AYAA KU QORMI DOONTAA -->
              <div class="line">
                <span class="muted">Umsatzsteuer</span>
                <span id="pVat">0,00 €</span>
              </div>

              <div class="ustg-note" id="pUstgNote">
                <b>Hinweis:</b> Gemäß §19 UStG wird keine Umsatzsteuer berechnet.
              </div>

              <div class="line grand">
                <span style="font-weight:800">Gesamtbetrag</span>
                <span style="font-weight:800" id="pGross">0,00 €</span>
              </div>
            </div>

            <div style="margin-top:12px" class="muted" id="pNote"></div>

            <div class="small" style="margin-top:14px">
              PDF = Browser Print → “Als PDF speichern”.
            </div>
          </div>
        </div>

        <div class="card no-print">
          <h2>Save / Load</h2>
          <div class="small">Waxaan ku keydinaynaa browser-ka (localStorage). GitHub/Netlify update = commit cusub.</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
            <button id="btnLoad">Load</button>
            <button id="btnClear">Clear Storage</button>
          </div>
          <div class="small" style="margin-top:10px">
            Haddii Netlify “app” aanu update samayn: samee <b>Hard refresh</b> (Ctrl+Shift+R) ama “Clear site cache” Netlify.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== helpers =====
    const LS_KEY = "ms_invoice_single_v1";
    const $ = (id) => document.getElementById(id);

    function toMoney(n){
      const x = Number(n || 0);
      return x.toLocaleString("de-DE", { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " €";
    }

    function todayISO(){
      const d = new Date();
      const pad = (v) => String(v).padStart(2,"0");
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
    }

    function calc(){
      const amount = Number($("amount").value || 0);        // user input (gross if VAT=0, otherwise treated as net base)
      const vatRate = Number($("vatRate").value || 0);

      let net = amount, vat = 0, gross = amount;

      if (vatRate > 0){
        // assume amount is NET base; VAT added
        vat = net * (vatRate/100);
        gross = net + vat;
      } else {
        // Kleinunternehmer: VAT = 0, gross = net
        vat = 0;
        gross = net;
      }

      // preview fields
      $("pNet").textContent = toMoney(net);
      $("pVat").textContent = toMoney(vat);
      $("pGross").textContent = toMoney(gross);

      // show/hide §19 note
      $("pUstgNote").style.display = (vatRate === 0) ? "block" : "none";
    }

    function render(){
      const invNo = $("invNo").value.trim() || "—";
      const invDate = $("invDate").value || "—";
      const cust = $("custName").value.trim() || "—";
      const desc = $("desc").value.trim() || "—";
      const amount = Number($("amount").value || 0);
      const status = $("status").value;
      const note = $("note").value.trim();

      $("pMeta").textContent = `Nr. ${invNo} • Datum ${invDate}`;
      $("pStatus").textContent = status;
      $("pCustomer").textContent = cust;
      $("pDesc").textContent = desc;
      $("pAmount").textContent = toMoney(amount);
      $("pNote").textContent = note ? note : "";

      calc();
    }

    function getState(){
      return {
        invNo: $("invNo").value,
        invDate: $("invDate").value,
        custName: $("custName").value,
        desc: $("desc").value,
        amount: $("amount").value,
        vatRate: $("vatRate").value,
        status: $("status").value,
        note: $("note").value
      };
    }

    function setState(s){
      if(!s) return;
      $("invNo").value = s.invNo ?? $("invNo").value;
      $("invDate").value = s.invDate ?? $("invDate").value;
      $("custName").value = s.custName ?? "";
      $("desc").value = s.desc ?? "";
      $("amount").value = s.amount ?? "0.00";
      $("vatRate").value = s.vatRate ?? "0";
      $("status").value = s.status ?? "Entwurf";
      $("note").value = s.note ?? "";
      render();
    }

    function save(){
      localStorage.setItem(LS_KEY, JSON.stringify(getState()));
    }

    function load(){
      const raw = localStorage.getItem(LS_KEY);
      if(!raw) return;
      try{ setState(JSON.parse(raw)); }catch(e){}
    }

    function reset(){
      setState({
        invNo:"RE-2026-0001",
        invDate: todayISO(),
        custName:"",
        desc:"",
        amount:"0.00",
        vatRate:"0",
        status:"Entwurf",
        note:""
      });
      save();
    }

    // ===== events =====
    ["invNo","invDate","custName","desc","amount","vatRate","status","note"].forEach(id=>{
      $(id).addEventListener("input", ()=>{ render(); save(); });
      $(id).addEventListener("change", ()=>{ render(); save(); });
    });

    $("btnSave").addEventListener("click", ()=>{ save(); alert("Gespeichert ✅"); });
    $("btnLoad").addEventListener("click", ()=>{ load(); alert("Geladen ✅"); });
    $("btnClear").addEventListener("click", ()=>{
      localStorage.removeItem(LS_KEY);
      alert("Storage gelöscht ✅");
    });

    $("btnReset").addEventListener("click", ()=>{ reset(); });
    $("btnPrint").addEventListener("click", ()=>{ window.print(); });

    // init
    if(!$("invDate").value) $("invDate").value = todayISO();
    load();
    render();
  </script>
</body>
</html>
