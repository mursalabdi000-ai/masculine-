@echo off
setlocal EnableExtensions EnableDelayedExpansion

REM ====== 1) Tag folder-ka dist ======
cd /d "C:\Users\mours\Desktop\MY APP\masculine-security\masculine-security\dist" || (
  echo [ERROR] Path-ka dist lama helin. Sax path-ka cd /d dusha.
  pause
  exit /b 1
)

REM ====== 2) Samee files: index.html, manifest.json, service-worker.js ======

REM ---------- index.html ----------
(
echo ^<!doctype html^>
echo ^<html lang="de"^>
echo ^<head^>
echo   ^<meta charset="utf-8" /^>
echo   ^<meta name="viewport" content="width=device-width, initial-scale=1" /^>
echo   ^<title^>Masculine Security ‚Äî Mini Office^</title^>
echo   ^<meta name="theme-color" content="#0b1220"^>
echo   ^<link rel="manifest" href="/masculine/manifest.json"^>
echo   ^<style^>
echo     :root{--bg:#0b1220;--panel:#0f1a2f;--panel2:#0c1629;--card:#10203a;--muted:#93a4c6;--text:#e7eeff;--line:#1a2a4b;--accent:#3aa6ff;--accent2:#2bd4bd;--danger:#ff4d6d;--shadow:0 14px 40px rgba(0,0,0,.45);--radius:16px;--radius2:12px;--font:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
echo     *{box-sizing:border-box} body{margin:0;font-family:var(--font);background:radial-gradient(1200px 700px at 30%% -10%%, rgba(58,166,255,.22), transparent 55%%),radial-gradient(1000px 600px at 90%% 10%%, rgba(43,212,189,.18), transparent 55%%),linear-gradient(180deg,#07101f 0%%,#070d18 100%%);color:var(--text)}
echo     .app{min-height:100vh;display:grid;grid-template-columns:280px 1fr;gap:18px;padding:18px;max-width:1320px;margin:0 auto}
echo     .sidebar{background:linear-gradient(180deg, rgba(16,32,58,.78), rgba(12,22,41,.78));border:1px solid rgba(255,255,255,.06);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px;position:sticky;top:14px;height:calc(100vh - 28px);display:flex;flex-direction:column}
echo     .brand{display:flex;gap:12px;align-items:center;padding:10px;border-radius:var(--radius2);background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.05)}
echo     .logo{width:42px;height:42px;border-radius:14px;background:linear-gradient(135deg, rgba(58,166,255,.9), rgba(43,212,189,.9));display:grid;place-items:center;color:#06101f;font-weight:900}
echo     .brand h1{margin:0;font-size:14px;line-height:1.2} .brand small{display:block;color:var(--muted);font-size:12px;margin-top:2px}
echo     .nav{margin-top:12px;display:flex;flex-direction:column;gap:8px}
echo     .nav button{all:unset;display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 12px;border-radius:14px;cursor:pointer;border:1px solid rgba(255,255,255,.06);background:rgba(255,255,255,.02);transition:.15s ease}
echo     .nav button:hover{transform:translateY(-1px);border-color:rgba(58,166,255,.35);background:rgba(58,166,255,.08)}
echo     .nav button.active{border-color:rgba(58,166,255,.55);background:rgba(58,166,255,.14);box-shadow:0 10px 26px rgba(0,0,0,.25)}
echo     .nav .left{display:flex;align-items:center;gap:10px;font-weight:700;font-size:13px}
echo     .pill{font-size:12px;color:var(--muted);padding:4px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.08);background:rgba(0,0,0,.16)}
echo     .foot{margin-top:auto;padding:10px;border-top:1px solid rgba(255,255,255,.06);color:var(--muted);font-size:12px}
echo     .main{background:linear-gradient(180deg, rgba(16,32,58,.55), rgba(12,22,41,.55));border:1px solid rgba(255,255,255,.06);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column;min-height:calc(100vh - 36px)}
echo     .topbar{padding:14px;display:flex;align-items:center;justify-content:space-between;gap:12px;border-bottom:1px solid rgba(255,255,255,.06);background:rgba(0,0,0,.12)}
echo     .crumb{display:flex;flex-direction:column;gap:2px} .crumb h2{margin:0;font-size:14px} .crumb small{color:var(--muted)}
echo     .actions{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end}
echo     .btn{border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.04);color:var(--text);padding:9px 12px;border-radius:12px;cursor:pointer;transition:.15s ease;font-weight:700;font-size:13px}
echo     .btn:hover{transform:translateY(-1px);border-color:rgba(58,166,255,.4);background:rgba(58,166,255,.10)}
echo     .btn.primary{border-color:rgba(58,166,255,.55);background:rgba(58,166,255,.16)}
echo     .btn.good{border-color:rgba(43,212,189,.55);background:rgba(43,212,189,.14)}
echo     .btn.danger{border-color:rgba(255,77,109,.45);background:rgba(255,77,109,.10)}
echo     .content{padding:14px;display:grid;gap:14px}
echo     .grid2{display:grid;grid-template-columns:1.2fr .8fr;gap:14px}
echo     .grid3{display:grid;grid-template-columns:repeat(3, 1fr);gap:14px}
echo     .card{background:rgba(16,32,58,.55);border:1px solid rgba(255,255,255,.06);border-radius:var(--radius2);padding:14px}
echo     .card h3{margin:0 0 10px 0;font-size:14px}
echo     .muted{color:var(--muted)}
echo     .kpi{display:flex;align-items:flex-end;justify-content:space-between;gap:10px}
echo     .kpi .value{font-size:22px;font-weight:900}
echo     .kpi .label{color:var(--muted);font-size:12px;font-weight:700}
echo     .table{width:100%%;border-collapse:collapse;overflow:hidden;border-radius:12px}
echo     .table th,.table td{padding:10px 10px;border-bottom:1px solid rgba(255,255,255,.06);text-align:left;font-size:13px}
echo     .table th{color:var(--muted);font-weight:800;font-size:12px}
echo     .field{display:flex;flex-direction:column;gap:6px;margin-bottom:10px}
echo     .field label{font-size:12px;color:var(--muted);font-weight:800}
echo     .field input,.field select,.field textarea{width:100%%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.18);color:var(--text);outline:none}
echo     .field textarea{min-height:96px;resize:vertical}
echo     .split{display:grid;grid-template-columns:1fr 1fr;gap:10px}
echo     .notice{border:1px dashed rgba(58,166,255,.45);background:rgba(58,166,255,.08);padding:12px;border-radius:12px;color:var(--text);font-size:13px}
echo     .tag{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.18);font-size:12px;font-weight:800;color:var(--muted)}
echo     .right{text-align:right} .hide{display:none!important} .hr{height:1px;background:rgba(255,255,255,.06);margin:10px 0}
echo     .toast{position:fixed;right:16px;bottom:16px;max-width:360px;background:rgba(16,32,58,.92);border:1px solid rgba(255,255,255,.10);border-radius:14px;padding:12px;box-shadow:var(--shadow);display:none}
echo     .toast.show{display:block}
echo     @media(max-width:980px){.app{grid-template-columns:1fr}.sidebar{position:relative;height:auto}.grid2,.grid3{grid-template-columns:1fr}}
echo   ^</style^>
echo ^</head^>
echo ^<body^>
echo   ^<div class="app"^>
echo     ^<aside class="sidebar"^>
echo       ^<div class="brand"^>
echo         ^<div class="logo"^>MS^</div^>
echo         ^<div^>
echo           ^<h1^>Masculine Security^</h1^>
echo           ^<small^>Mini Office ‚Ä¢ Offline (local)^</small^>
echo         ^</div^>
echo       ^</div^>
echo       ^<div class="nav" id="nav"^>
echo         ^<button data-page="overview" class="active"^>^<div class="left"^>üè† √úbersicht ^<span class="pill"^>KPIs^</span^>^</div^>^<span class="pill"^ id="countOverview"^>‚Äì^</span^>^</button^>
echo         ^<button data-page="customers"^>^<div class="left"^>üë§ Kunden^</div^>^<span class="pill" id="countCustomers"^>0^</span^>^</button^>
echo         ^<button data-page="invoices"^>^<div class="left"^>üßæ Rechnungen^</div^>^<span class="pill" id="countInvoices"^>0^</span^>^</button^>
echo         ^<button data-page="expenses"^>^<div class="left"^>üí≥ Ausgaben^</div^>^<span class="pill" id="countExpenses"^>0^</span^>^</button^>
echo         ^<button data-page="settings"^>^<div class="left"^>‚öôÔ∏è Einstellungen^</div^>^<span class="pill"^>Profile^</span^>^</button^>
echo       ^</div^>
echo       ^<div class="foot"^>
echo         ^<div^>^<b^>Tipp:^</b^> GitHub commit ‚Üí GitHub Pages update.^</div^>
echo         ^<div class="muted"^>Hard refresh: Ctrl+Shift+R haddii aan isbeddel muuqan.^</div^>
echo         ^<div class="muted" id="pwaState"^>PWA: checking‚Ä¶^</div^>
echo       ^</div^>
echo     ^</aside^>
echo
echo     ^<main class="main"^>
echo       ^<div class="topbar"^>
echo         ^<div class="crumb"^>
echo           ^<h2 id="pageTitle"^>√úbersicht^</h2^>
echo           ^<small id="pageSub" class="muted"^>Umsatz ‚Ä¢ Ausgaben ‚Ä¢ Kunden ‚Ä¢ Rechnungen (offline)^</small^>
echo         ^</div^>
echo         ^<div class="actions"^>
echo           ^<button class="btn primary" id="btnInstall" style="display:none"^>Install App^</button^>
echo           ^<button class="btn good" id="btnExport"^>Export JSON^</button^>
echo           ^<button class="btn" id="btnImport"^>Import JSON^</button^>
echo         ^</div^>
echo       ^</div^>
echo
echo       ^<div class="content"^>
echo         ^<section id="page-overview"^>
echo           ^<div class="grid3"^>
echo             ^<div class="card"^>^<div class="kpi"^>^<div^>^<div class="label"^>Umsatz (Monat)^</div^>^<div class="value" id="kpiRevenue"^>0,00 ‚Ç¨^</div^>^<div class="muted" style="font-size:12px"^>Umsatzsteuer: ^<span id="kpiVat"^>0,00 ‚Ç¨^</span^> ‚Ä¢ Brutto: ^<span id="kpiGross"^>0,00 ‚Ç¨^</span^>^</div^>^</div^>^<span class="tag"^>üìà^</span^>^</div^>^</div^>
echo             ^<div class="card"^>^<div class="kpi"^>^<div^>^<div class="label"^>Ausgaben (Monat)^</div^>^<div class="value" id="kpiExpenses"^>0,00 ‚Ç¨^</div^>^<div class="muted" style="font-size:12px"^>Betrag total gespeichert^</div^>^</div^>^<span class="tag"^>üí≥^</span^>^</div^>^</div^>
echo             ^<div class="card"^>^<div class="kpi"^>^<div^>^<div class="label"^>Kleinunternehmer^</div^>^<div class="value"^>¬ß19 UStG^</div^>^<div class="muted" style="font-size:12px"^>USt wird nicht berechnet^</div^>^</div^>^<span class="tag"^>üßæ^</span^>^</div^>^</div^>
echo           ^</div^>
echo           ^<div class="grid2"^>
echo             ^<div class="card"^>
echo               ^<h3^>Hinweis (Kleinunternehmer)^</h3^>
echo               ^<div class="notice"^>
echo                 ^<b^>Umsatzsteuer: 0,00 ‚Ç¨^</b^> ‚Äî Hinweis: Gem√§√ü ¬ß19 UStG wird keine Umsatzsteuer berechnet.^<br/^>
echo                 F√ºr Install: manifest + service worker m√ºssen exakt auf ^<code^>/masculine/^</code^> passen.
echo               ^</div^>
echo             ^</div^>
echo             ^<div class="card"^>
echo               ^<h3^>Schnellstart^</h3^>
echo               ^<div class="muted"^>Daten werden offline im Browser gespeichert (localStorage).^</div^>
echo               ^<div class="hr"^>^</div^>
echo               ^<div class="split"^>
echo                 ^<button class="btn primary" onclick="UI.go('customers')"^>+ Kunde^</button^>
echo                 ^<button class="btn" onclick="UI.go('invoices')"^>+ Rechnung^</button^>
echo               ^</div^>
echo             ^</div^>
echo           ^</div^>
echo         ^</section^>
echo
echo         ^<section id="page-customers" class="hide"^>
echo           ^<div class="grid2"^>
echo             ^<div class="card"^>
echo               ^<h3^>Kunde hinzuf√ºgen^</h3^>
echo               ^<div class="field"^>^<label for="c_name"^>Firmenname / Name^</label^>^<input id="c_name" placeholder="z.B. Beispiel Kunde GmbH"^>^</div^>
echo               ^<div class="field"^>^<label for="c_email"^>Email^</label^>^<input id="c_email" placeholder="kunde@email.de"^>^</div^>
echo               ^<div class="field"^>^<label for="c_addr"^>Adresse^</label^>^<input id="c_addr" placeholder="Stra√üe, PLZ Ort"^>^</div^>
echo               ^<button class="btn primary" onclick="Customers.add()"^>Speichern^</button^>
echo               ^<button class="btn danger" onclick="Customers.clearForm()"^>Leeren^</button^>
echo             ^</div^>
echo             ^<div class="card"^>
echo               ^<h3^>Kundenliste^</h3^>
echo               ^<table class="table"^>
echo                 ^<thead^>^<tr^>^<th^>Name^</th^>^<th^>Email^</th^>^<th^>Adresse^</th^>^<th class="right"^>Aktion^</th^>^</tr^>^</thead^>
echo                 ^<tbody id="customersList"^>^</tbody^>
echo               ^</table^>
echo             ^</div^>
echo           ^</div^>
echo         ^</section^>
echo
echo         ^<section id="page-invoices" class="hide"^>
echo           ^<div class="grid2"^>
echo             ^<div class="card"^>
echo               ^<h3^>Rechnung erstellen^</h3^>
echo               ^<div class="split"^>
echo                 ^<div class="field"^>^<label for="i_no"^>Rechnungs-Nr.^</label^>^<input id="i_no" placeholder="RE-2026-0001"^>^</div^>
echo                 ^<div class="field"^>^<label for="i_date"^>Datum^</label^>^<input id="i_date" type="date"^>^</div^>
echo               ^</div^>
echo               ^<div class="field"^>^<label for="i_customer"^>Kunde^</label^>^<select id="i_customer"^>^</select^>^</div^>
echo               ^<div class="split"^>
echo                 ^<div class="field"^>^<label for="i_desc"^>Leistung / Beschreibung^</label^>^<input id="i_desc" placeholder="z.B. Objektschutz 12h"^>^</div^>
echo                 ^<div class="field"^>^<label for="i_net"^>Netto (‚Ç¨)^</label^>^<input id="i_net" type="number" step="0.01" placeholder="0.00"^>^</div^>
echo               ^</div^>
echo               ^<div class="split"^>
echo                 ^<div class="field"^>^<label for="i_vatRate"^>USt %% (0 f√ºr Kleinunternehmer)^</label^>^<input id="i_vatRate" type="number" step="0.01" value="0"^>^</div^>
echo                 ^<div class="field"^>^<label for="i_status"^>Status^</label^>
echo                   ^<select id="i_status"^>^<option^>Entwurf^</option^>^<option^>Gesendet^</option^>^<option^>Bezahlt^</option^>^</select^>
echo                 ^</div^>
echo               ^</div^>
echo               ^<button class="btn primary" onclick="Invoices.add()"^>Speichern^</button^>
echo               ^<button class="btn" onclick="Invoices.print()"^>PDF √∂ffnen^</button^>
echo               ^<button class="btn danger" onclick="Invoices.clearForm()"^>Leeren^</button^>
echo               ^<div class="muted" style="margin-top:10px"^>PDF = Browser Print (Save as PDF).^</div^>
echo             ^</div^>
echo             ^<div class="card"^>
echo               ^<h3^>Rechnungen^</h3^>
echo               ^<table class="table"^>
echo                 ^<thead^>^<tr^>^<th^>Nr.^</th^>^<th^>Kunde^</th^>^<th^>Datum^</th^>^<th^>Status^</th^>^<th class="right"^>Netto^</th^>^<th class="right"^>Aktion^</th^>^</tr^>^</thead^>
echo                 ^<tbody id="invoicesList"^>^</tbody^>
echo               ^</table^>
echo             ^</div^>
echo           ^</div^>
echo         ^</section^>
echo
echo         ^<section id="page-expenses" class="hide"^>
echo           ^<div class="card"^>
echo             ^<h3^>Ausgaben (Demo)^</h3^>
echo             ^<div class="muted"^>Qeybtaan waad ballaarin kartaa. Hadda focus waa PWA Install.^</div^>
echo           ^</div^>
echo         ^</section^>
echo
echo         ^<section id="page-settings" class="hide"^>
echo           ^<div class="grid2"^>
echo             ^<div class="card"^>
echo               ^<h3^>Einstellungen (Deine Daten)^</h3^>
echo               ^<div class="field"^>^<label for="s_name"^>Name / Firma^</label^>^<input id="s_name" placeholder="z.B. Masculine Security"^>^</div^>
echo               ^<div class="field"^>^<label for="s_addr"^>Adresse^</label^>^<input id="s_addr" placeholder="Stra√üe, PLZ Ort"^>^</div^>
echo               ^<div class="field"^>^<label for="s_email"^>Email^</label^>^<input id="s_email" placeholder="kontakt@..."^>^</div^>
echo               ^<div class="field"^>^<label for="s_iban"^>IBAN^</label^>^<input id="s_iban" placeholder="DE.."^>^</div^>
echo               ^<div class="field"^>^<label for="s_bic"^>BIC^</label^>^<input id="s_bic" placeholder="..."^>^</div^>
echo               ^<button class="btn primary" onclick="Settings.save()"^>Save^</button^>
echo               ^<button class="btn danger" onclick="Settings.clear()"^>Reset^</button^>
echo               ^<div class="muted" style="margin-top:10px"^>Xogtan waxaa lagu kaydiyaa localStorage. Markaad PDF sameyso, waxaa lagu qoraa header-ka.^</div^>
echo             ^</div^>
echo             ^<div class="card"^>
echo               ^<h3^>PWA Status^</h3^>
echo               ^<div class="notice" id="statusBox"^>Checking‚Ä¶^</div^>
echo               ^<div class="hr"^>^</div^>
echo               ^<div class="muted"^>
echo                 Haddii Install uusan muuqan: (1) URL waa inuu noqdaa ^<b^>https://mursalabdi000-ai.github.io/masculine/^</b^>  (2) Incognito ha isticmaalin (3) Hard refresh.
echo               ^</div^>
echo             ^</div^>
echo           ^</div^>
echo         ^</section^>
echo       ^</div^>
echo     ^</main^>
echo   ^</div^>
echo
echo   ^<div class="toast" id="toast"^>^</div^>
echo
echo ^<script^>
echo   const LS = {
echo     get: (k, d) => { try { const v = localStorage.getItem(k); return v ? JSON.parse(v) : d; } catch(e){ return d; } },
echo     set: (k, v) => localStorage.setItem(k, JSON.stringify(v))
echo   };
echo
echo   const UI = {
echo     go(page){
echo       document.querySelectorAll('section[id^="page-"]').forEach(s=>s.classList.add('hide'));
echo       document.getElementById('page-' + page).classList.remove('hide');
echo       document.querySelectorAll('#nav button').forEach(b=>b.classList.toggle('active', b.dataset.page===page));
echo       document.getElementById('pageTitle').textContent = ({
echo         overview:'√úbersicht', customers:'Kunden', invoices:'Rechnungen', expenses:'Ausgaben', settings:'Einstellungen'
echo       })[page] || page;
echo       document.getElementById('pageSub').textContent = 'Umsatz ‚Ä¢ Ausgaben ‚Ä¢ Kunden ‚Ä¢ Rechnungen (offline)';
echo       refreshAll();
echo     },
echo     toast(msg){
echo       const t = document.getElementById('toast');
echo       t.textContent = msg;
echo       t.classList.add('show');
echo       setTimeout(()=>t.classList.remove('show'), 2400);
echo     }
echo   };
echo
echo   const Customers = {
echo     list: () => LS.get('customers', []),
echo     save: (arr) => LS.set('customers', arr),
echo     add(){
echo       const arr = Customers.list();
echo       const name = (document.getElementById('c_name').value||'').trim();
echo       const email = (document.getElementById('c_email').value||'').trim();
echo       const addr = (document.getElementById('c_addr').value||'').trim();
echo       if(!name){ UI.toast('Name fehlt'); return; }
echo       arr.push({id: crypto.randomUUID(), name, email, addr});
echo       Customers.save(arr);
echo       Customers.clearForm();
echo       UI.toast('Gespeichert');
echo       refreshAll();
echo     },
echo     del(id){
echo       Customers.save(Customers.list().filter(x=>x.id!==id));
echo       refreshAll();
echo     },
echo     clearForm(){
echo       ['c_name','c_email','c_addr'].forEach(i=>document.getElementById(i).value='');
echo     }
echo   };
echo
echo   const Invoices = {
echo     list: () => LS.get('invoices', []),
echo     save: (arr) => LS.set('invoices', arr),
echo     add(){
echo       const no = (document.getElementById('i_no').value||'').trim();
echo       const date = document.getElementById('i_date').value;
echo       const customerId = document.getElementById('i_customer').value;
echo       const desc = (document.getElementById('i_desc').value||'').trim();
echo       const net = parseFloat(document.getElementById('i_net').value||'0') || 0;
echo       const vatRate = parseFloat(document.getElementById('i_vatRate').value||'0') || 0;
echo       const status = document.getElementById('i_status').value;
echo       if(!no || !date || !customerId){ UI.toast('Nr/Datum/Kunde fehlt'); return; }
echo       const arr = Invoices.list();
echo       arr.push({id: crypto.randomUUID(), no, date, customerId, desc, net, vatRate, status});
echo       Invoices.save(arr);
echo       UI.toast('Rechnung gespeichert');
echo       refreshAll();
echo     },
echo     del(id){ Invoices.save(Invoices.list().filter(x=>x.id!==id)); refreshAll(); },
echo     clearForm(){ ['i_no','i_date','i_desc','i_net'].forEach(i=>document.getElementById(i).value=''); document.getElementById('i_vatRate').value='0'; document.getElementById('i_status').value='Entwurf'; },
echo     print(){
echo       const s = Settings.get();
echo       const no = (document.getElementById('i_no').value||'').trim();
echo       const date = document.getElementById('i_date').value;
echo       const customerId = document.getElementById('i_customer').value;
echo       const customer = Customers.list().find(c=>c.id===customerId) || {name:'',email:'',addr:''};
echo       const desc = (document.getElementById('i_desc').value||'').trim();
echo       const net = parseFloat(document.getElementById('i_net').value||'0') || 0;
echo       const vatRate = parseFloat(document.getElementById('i_vatRate').value||'0') || 0;
echo       const vat = net * (vatRate/100);
echo       const gross = net + vat;
echo       const note = (vatRate===0) ? 'Hinweis: Gem√§√ü ¬ß19 UStG wird keine Umsatzsteuer berechnet.' : '';
echo
echo       const w = window.open('', '_blank');
echo       w.document.write(`^<!doctype html^>
echo ^<html^>^<head^>^<meta charset="utf-8"^>^<title^>Rechnung ${no}^</title^>
echo ^<style^>body{font-family:Arial;margin:40px}h1{margin:0 0 6px}small{color:#555}table{width:100%%;border-collapse:collapse;margin-top:18px}td,th{border-bottom:1px solid #ddd;padding:10px;text-align:left}.right{text-align:right}.box{margin-top:18px;padding:12px;border:1px solid #ddd}^</style^>
echo ^</head^>^<body^>
echo ^<h1^>${(s.name||'Masculine Security')}^</h1^>
echo ^<small^>${s.addr||''} ‚Ä¢ ${s.email||''}^</small^>
echo ^<div class="box"^>
echo ^<b^>Rechnung-Nr.:^</b^> ${no}^<br^>
echo ^<b^>Datum:^</b^> ${date}^<br^>
echo ^<b^>Kunde:^</b^> ${customer.name}^<br^>
echo ^<small^>${customer.addr} ‚Ä¢ ${customer.email}^</small^>
echo ^</div^>
echo ^<table^>
echo ^<thead^>^<tr^>^<th^>Beschreibung^</th^>^<th class="right"^>Netto^</th^>^<th class="right"^>USt^</th^>^<th class="right"^>Brutto^</th^>^</tr^>^</thead^>
echo ^<tbody^>^<tr^>
echo ^<td^>${desc}^</td^>
echo ^<td class="right"^>${net.toFixed(2)} ‚Ç¨^</td^>
echo ^<td class="right"^>${vat.toFixed(2)} ‚Ç¨^</td^>
echo ^<td class="right"^>${gross.toFixed(2)} ‚Ç¨^</td^>
echo ^</tr^>^</tbody^>^</table^>
echo ^<div class="box"^>
echo ^<b^>Umsatzsteuer:^</b^> ${vat.toFixed(2)} ‚Ç¨^<br^>
echo ^<b^>Hinweis:^</b^> ${note}^
echo ^</div^>
echo ^<div class="box"^>
echo ^<b^>Zahlung:^</b^> IBAN: ${s.iban||''} ‚Ä¢ BIC: ${s.bic||''}^
echo ^</div^>
echo ^</body^>^</html^>`);
echo       w.document.close();
echo       w.focus();
echo       setTimeout(()=>w.print(), 600);
echo     }
echo   };
echo
echo   const Settings = {
echo     get: ()=> LS.get('settings', {name:'',addr:'',email:'',iban:'',bic:''}),
echo     load(){
echo       const s = Settings.get();
echo       document.getElementById('s_name').value = s.name||'';
echo       document.getElementById('s_addr').value = s.addr||'';
echo       document.getElementById('s_email').value = s.email||'';
echo       document.getElementById('s_iban').value = s.iban||'';
echo       document.getElementById('s_bic').value = s.bic||'';
echo     },
echo     save(){
echo       const s = {
echo         name:(document.getElementById('s_name').value||'').trim(),
echo         addr:(document.getElementById('s_addr').value||'').trim(),
echo         email:(document.getElementById('s_email').value||'').trim(),
echo         iban:(document.getElementById('s_iban').value||'').trim(),
echo         bic:(document.getElementById('s_bic').value||'').trim()
echo       };
echo       LS.set('settings', s);
echo       UI.toast('Saved');
echo     },
echo     clear(){ localStorage.removeItem('settings'); Settings.load(); UI.toast('Reset'); }
echo   };
echo
echo   function euro(n){ return (n||0).toFixed(2).replace('.', ',') + ' ‚Ç¨'; }
echo
echo   function refreshAll(){
echo     const customers = Customers.list();
echo     const invoices = Invoices.list();
echo
echo     document.getElementById('countCustomers').textContent = customers.length;
echo     document.getElementById('countInvoices').textContent = invoices.length;
echo     document.getElementById('countExpenses').textContent = 0;
echo     document.getElementById('countOverview').textContent = 'KPIs';
echo
echo     // customers list table
echo     const cBody = document.getElementById('customersList');
echo     if(cBody){
echo       cBody.innerHTML = customers.map(c=>`
echo         ^<tr^>
echo           ^<td^>${c.name}^</td^>
echo           ^<td^>${c.email||''}^</td^>
echo           ^<td^>${c.addr||''}^</td^>
echo           ^<td class="right"^>^<button class="btn mini danger" onclick="Customers.del('${c.id}')"^>L√∂schen^</button^>^</td^>
echo         ^</tr^>`).join('');
echo     }
echo
echo     // invoice customer dropdown
echo     const sel = document.getElementById('i_customer');
echo     if(sel){
echo       sel.innerHTML = customers.length
echo         ? customers.map(c=>`^<option value="${c.id}"^>${c.name}^</option^>`).join('')
echo         : `^<option value=""^>‚Äî Erst Kunde anlegen ‚Äî^</option^>`;
echo     }
echo
echo     // invoices table
echo     const iBody = document.getElementById('invoicesList');
echo     if(iBody){
echo       iBody.innerHTML = invoices.map(i=>{
echo         const c = customers.find(x=>x.id===i.customerId) || {name:'‚Äî'};
echo         return `
echo         ^<tr^>
echo           ^<td^>${i.no}^</td^>
echo           ^<td^>${c.name}^</td^>
echo           ^<td^>${i.date}^</td^>
echo           ^<td^>${i.status}^</td^>
echo           ^<td class="right"^>${euro(i.net)}^</td^>
echo           ^<td class="right"^>^<button class="btn mini danger" onclick="Invoices.del('${i.id}')"^>L√∂schen^</button^>^</td^>
echo         ^</tr^>`;
echo       }).join('');
echo     }
echo
echo     // KPI
echo     const totalNet = invoices.reduce((a,x)=>a+(+x.net||0),0);
echo     const totalVat = invoices.reduce((a,x)=>a+((+x.net||0)*((+x.vatRate||0)/100)),0);
echo     document.getElementById('kpiRevenue').textContent = euro(totalNet);
echo     document.getElementById('kpiVat').textContent = euro(totalVat);
echo     document.getElementById('kpiGross').textContent = euro(totalNet + totalVat);
echo     document.getElementById('kpiExpenses').textContent = euro(0);
echo
echo     Settings.load();
echo     updateStatusBox();
echo   }
echo
echo   // Export / Import
echo   document.getElementById('btnExport').addEventListener('click', ()=>{
echo     const data = {
echo       customers: Customers.list(),
echo       invoices: Invoices.list(),
echo       settings: Settings.get(),
echo       exportedAt: new Date().toISOString()
echo     };
echo     const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
echo     const a = document.createElement('a');
echo     a.href = URL.createObjectURL(blob);
echo     a.download = 'ms-mini-office-backup.json';
echo     a.click();
echo     URL.revokeObjectURL(a.href);
echo   });
echo
echo   document.getElementById('btnImport').addEventListener('click', ()=>{
echo     const inp = document.createElement('input');
echo     inp.type = 'file';
echo     inp.accept = 'application/json';
echo     inp.onchange = async ()=>{
echo       const f = inp.files[0]; if(!f) return;
echo       const txt = await f.text();
echo       const obj = JSON.parse(txt);
echo       if(obj.customers) LS.set('customers', obj.customers);
echo       if(obj.invoices) LS.set('invoices', obj.invoices);
echo       if(obj.settings) LS.set('settings', obj.settings);
echo       UI.toast('Import OK');
echo       refreshAll();
echo     };
echo     inp.click();
echo   });
echo
echo   // Navigation
echo   document.getElementById('nav').addEventListener('click', (e)=>{
echo     const btn = e.target.closest('button[data-page]'); if(!btn) return;
echo     UI.go(btn.dataset.page);
echo   });
echo
echo   // ===== PWA install handling =====
echo   let deferredPrompt = null;
echo   const installBtn = document.getElementById('btnInstall');
echo
echo   window.addEventListener('beforeinstallprompt', (e)=>{
echo     e.preventDefault();
echo     deferredPrompt = e;
echo     installBtn.style.display = 'inline-block';
echo     document.getElementById('pwaState').textContent = 'PWA: install available';
echo     updateStatusBox();
echo   });
echo
echo   installBtn.addEventListener('click', async ()=>{
echo     if(!deferredPrompt){ UI.toast('Install not ready'); return; }
echo     deferredPrompt.prompt();
echo     const res = await deferredPrompt.userChoice;
echo     deferredPrompt = null;
echo     installBtn.style.display = 'none';
echo     UI.toast('Install: ' + res.outcome);
echo     updateStatusBox();
echo   });
echo
echo   window.addEventListener('appinstalled', ()=>{
echo     UI.toast('App installed ‚úÖ');
echo     document.getElementById('pwaState').textContent = 'PWA: installed';
echo     updateStatusBox();
echo   });
echo
echo   function updateStatusBox(){
echo     const box = document.getElementById('statusBox');
echo     if(!box) return;
echo     const isSecure = location.protocol === 'https:';
echo     const hasSW = !!navigator.serviceWorker;
echo     box.innerHTML =
echo       `^<b^>URL:^</b^> ${location.href}^<br^>`+
echo       `^<b^>Secure (https):^</b^> ${isSecure}^<br^>`+
echo       `^<b^>Service Worker API:^</b^> ${hasSW}^<br^>`+
echo       `^<b^>Install button:^</b^> ${installBtn.style.display!=='none'}^<br^>`+
echo       `^<b^>Hint:^</b^> GitHub Pages path must be ^<code^>/masculine/^</code^>.`;
echo   }
echo
echo   // Register service worker (IMPORTANT: /masculine/ path)
echo   (async ()=>{
echo     try{
echo       if('serviceWorker' in navigator){
echo         await navigator.serviceWorker.register('/masculine/service-worker.js', {scope:'/masculine/'});
echo         document.getElementById('pwaState').textContent = 'PWA: service worker registered';
echo       }else{
echo         document.getElementById('pwaState').textContent = 'PWA: service worker NOT supported';
echo       }
echo     }catch(err){
echo       document.getElementById('pwaState').textContent = 'PWA: SW error';
echo       console.error(err);
echo     }
echo     refreshAll();
echo   })();
echo
echo   // default date
echo   document.getElementById('i_date').valueAsDate = new Date();
echo   refreshAll();
echo ^</script^>
echo ^</body^>
echo ^</html^>
) > index.html

REM ---------- manifest.json ----------
(
echo {
echo   "id": "/masculine/",
echo   "name": "Masculine Security ‚Äì Mini Office",
echo   "short_name": "MS Office",
echo   "start_url": "/masculine/",
echo   "scope": "/masculine/",
echo   "display": "standalone",
echo   "background_color": "#0b1220",
echo   "theme_color": "#0b1220",
echo   "description": "Mini Office App ‚Äì Rechnungen, Kunden, Ausgaben, Lohnabrechnung, Einkommensteuer",
echo   "icons": [
echo     { "src": "/masculine/icon-192.png", "sizes": "192x192", "type": "image/png" },
echo     { "src": "/masculine/icon-512.png", "sizes": "512x512", "type": "image/png" }
echo   ]
echo }
) > manifest.json

REM ---------- service-worker.js ----------
(
echo const CACHE_NAME = 'ms-mini-office-v1';
echo const BASE = '/masculine/';
echo const ASSETS = [
echo   BASE,
echo   BASE + 'index.html',
echo   BASE + 'manifest.json',
echo   BASE + 'service-worker.js',
echo   BASE + 'icon-192.png',
echo   BASE + 'icon-512.png'
echo ];
echo
echo self.addEventListener('install', (event) =^> {
echo   event.waitUntil((async () =^> {
echo     const cache = await caches.open(CACHE_NAME);
echo     await cache.addAll(ASSETS);
echo     self.skipWaiting();
echo   })());
echo });
echo
echo self.addEventListener('activate', (event) =^> {
echo   event.waitUntil((async () =^> {
echo     const keys = await caches.keys();
echo     await Promise.all(keys.map(k =^> (k !== CACHE_NAME) ? caches.delete(k) : null));
echo     self.clients.claim();
echo   })());
echo });
echo
echo self.addEventListener('fetch', (event) =^> {
echo   const req = event.request;
echo   const url = new URL(req.url);
echo
echo   if (url.pathname.startsWith(BASE)) {
echo     event.respondWith((async () =^> {
echo       const cache = await caches.open(CACHE_NAME);
echo       const cached = await cache.match(req, {ignoreSearch:true});
echo       if (cached) return cached;
echo       try {
echo         const fresh = await fetch(req);
echo         if (fresh && fresh.ok && req.method === 'GET') cache.put(req, fresh.clone());
echo         return fresh;
echo       } catch (e) {
echo         return (await cache.match(BASE + 'index.html')) || new Response('Offline', {status:503});
echo       }
echo     })());
echo   }
echo });
) > service-worker.js

REM ====== 3) Quick check ======
echo.
echo [OK] Files created in dist:
dir /b

echo.
echo IMPORTANT:
echo 1) Push/commit dist files to GitHub repo (main branch)
echo 2) GitHub Pages: Settings -> Pages -> Branch main / (root) -> Save
echo 3) Open: https://mursalabdi000-ai.github.io/masculine/
echo 4) Ctrl+Shift+R then check Install button (top right) or beforeinstallprompt
echo.
pause
endlocal
